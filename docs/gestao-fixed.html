<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Gest√£o - M√≥veisDesign</title>
    <style>
      :root {
        --primary: 45 100% 51%;
        --primary-foreground: 0 0% 98%;
        --secondary: 45 20% 96%;
        --secondary-foreground: 45 8% 15%;
        --muted: 45 10% 95%;
        --muted-foreground: 45 4% 45%;
        --accent: 45 15% 92%;
        --accent-foreground: 45 8% 15%;
        --destructive: 0 84% 60%;
        --destructive-foreground: 0 0% 98%;
        --border: 45 10% 89%;
        --input: 45 10% 89%;
        --ring: 45 100% 51%;
        --background: 0 0% 100%;
        --foreground: 45 8% 15%;
        --card: 0 0% 100%;
        --card-foreground: 45 8% 15%;
        --success: 120 60% 50%;
        --success-foreground: 0 0% 98%;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        font-family: system-ui, -apple-system, sans-serif;
        line-height: 1.5;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .header {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        text-align: center;
      }
      
      .header h1 {
        color: hsl(var(--primary));
        font-size: 2rem;
        margin-bottom: 8px;
      }
      
      .header p {
        color: hsl(var(--muted-foreground));
      }
      
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }
      
      @media (max-width: 768px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      
      .card {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        padding: 24px;
      }
      
      .card h2 {
        color: hsl(var(--foreground));
        font-size: 1.25rem;
        margin-bottom: 16px;
      }
      
      .form-group {
        margin-bottom: 16px;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 4px;
        font-weight: 500;
        color: hsl(var(--foreground));
      }
      
      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid hsl(var(--border));
        border-radius: 4px;
        background: hsl(var(--background));
        color: hsl(var(--foreground));
        font-size: 14px;
      }
      
      .form-group textarea {
        resize: vertical;
        min-height: 80px;
      }
      
      .button {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: opacity 0.2s;
      }
      
      .button:hover {
        opacity: 0.9;
      }
      
      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .button-secondary {
        background: hsl(var(--secondary));
        color: hsl(var(--secondary-foreground));
      }
      
      .file-upload {
        border: 2px dashed hsl(var(--border));
        border-radius: 8px;
        padding: 24px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s;
      }
      
      .file-upload:hover {
        border-color: hsl(var(--primary));
      }
      
      .file-upload input {
        display: none;
      }
      
      .color-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }
      
      .color-option {
        padding: 4px 12px;
        border: 1px solid hsl(var(--border));
        border-radius: 16px;
        background: hsl(var(--secondary));
        color: hsl(var(--secondary-foreground));
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
      }
      
      .color-option.selected {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
      }
      
      .products-list {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        padding: 24px;
      }
      
      .product-item {
        display: flex;
        align-items: center;
        padding: 12px;
        border: 1px solid hsl(var(--border));
        border-radius: 4px;
        margin-bottom: 8px;
        background: hsl(var(--background));
      }
      
      .product-item img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 12px;
      }
      
      .product-info {
        flex: 1;
      }
      
      .product-info h4 {
        margin-bottom: 4px;
        color: hsl(var(--foreground));
      }
      
      .product-info p {
        color: hsl(var(--muted-foreground));
        font-size: 14px;
      }
      
      .product-actions {
        display: flex;
        gap: 8px;
      }
      
      .alert {
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 16px;
        border: 1px solid;
      }
      
      .alert-success {
        background: hsl(var(--success) / 0.1);
        border-color: hsl(var(--success));
        color: hsl(var(--success));
      }
      
      .alert-error {
        background: hsl(var(--destructive) / 0.1);
        border-color: hsl(var(--destructive));
        color: hsl(var(--destructive));
      }
      
      .hidden {
        display: none;
      }

      .upload-progress {
        margin-top: 12px;
        padding: 8px;
        background: hsl(var(--muted));
        border-radius: 4px;
        font-size: 12px;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: hsl(var(--border));
        border-radius: 3px;
        overflow: hidden;
        margin: 8px 0;
      }

      .progress-fill {
        height: 100%;
        background: hsl(var(--primary));
        width: 0%;
        transition: width 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div style="position: absolute; top: 20px; right: 20px;">
          <a href="./index.html" style="
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
          ">üìñ Ver Cat√°logo</a>
        </div>
        <h1>üõ†Ô∏è Gest√£o do Cat√°logo</h1>
        <p>Sistema de administra√ß√£o para gerenciar produtos do cat√°logo</p>
      </div>
      
      <div class="grid">
        <div class="card">
          <h2>Adicionar Produto</h2>
          
          <div id="alert-container"></div>
          
          <form id="product-form">
            <div class="form-group">
              <label for="product-name">Nome do Produto</label>
              <input type="text" id="product-name" name="name" required 
                     placeholder="Ex: Sof√° Moderno 3 Lugares">
            </div>
            
            <div class="form-group">
              <label for="product-category">Categoria</label>
              <select id="product-category" name="category" required>
                <option value="">Selecione uma categoria</option>
                <option value="Sof√°s">Sof√°s</option>
                <option value="Poltronas">Poltronas</option>
                <option value="Mesas">Mesas</option>
                <option value="Cadeiras">Cadeiras</option>
                <option value="Estantes">Estantes</option>
                <option value="Camas">Camas</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="product-description">Descri√ß√£o</label>
              <textarea id="product-description" name="description" required
                        placeholder="Descri√ß√£o detalhada do produto..."></textarea>
            </div>
            
            <div class="form-group">
              <label>Imagens do Produto</label>
              <div class="file-upload" onclick="document.getElementById('product-images').click()">
                <input type="file" id="product-images" name="images" multiple accept="image/*">
                <p>üì∑ Clique para selecionar imagens</p>
                <p style="font-size: 12px; color: hsl(var(--muted-foreground));">
                  Selecione uma ou mais imagens (JPG, PNG, m√°x 5MB cada)
                </p>
              </div>
              <div id="selected-images"></div>
              <div id="upload-progress" class="upload-progress hidden">
                <div>Fazendo upload das imagens...</div>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="upload-status">Preparando...</div>
              </div>
            </div>
            
            <div class="form-group">
              <label>Cores Dispon√≠veis</label>
              <div class="color-selector">
                <div class="color-option" data-color="branco">Branco</div>
                <div class="color-option" data-color="preto">Preto</div>
                <div class="color-option" data-color="cinza">Cinza</div>
                <div class="color-option" data-color="bege">Bege</div>
                <div class="color-option" data-color="marrom">Marrom</div>
                <div class="color-option" data-color="azul">Azul</div>
                <div class="color-option" data-color="verde">Verde</div>
                <div class="color-option" data-color="vermelho">Vermelho</div>
              </div>
              <input type="hidden" id="selected-colors" name="colors">
            </div>
            
            <button type="submit" class="button" id="submit-btn">
              üíæ Salvar Produto
            </button>
          </form>
        </div>
        
        <div class="card">
          <h2>Configura√ß√µes do GitHub</h2>
          
          <div class="form-group">
            <label for="github-token">Token do GitHub</label>
            <input type="password" id="github-token" 
                   placeholder="ghp_xxxxxxxxxxxxxxxx">
          </div>
          
          <div class="form-group">
            <label for="github-owner">Propriet√°rio</label>
            <input type="text" id="github-owner" value="MoveisBonafe" readonly>
          </div>
          
          <div class="form-group">
            <label for="github-repo">Reposit√≥rio</label>
            <input type="text" id="github-repo" value="Catalogo-Moveis-Bonafe" readonly>
          </div>
          
          <button type="button" class="button-secondary button" onclick="testGitHubConnection()">
            üîó Testar Conex√£o
          </button>
          
          <div style="margin-top: 16px; padding: 12px; background: hsl(var(--muted)); border-radius: 4px;">
            <p style="font-size: 14px; color: hsl(var(--muted-foreground));">
              üìù <strong>Como obter o token:</strong><br>
              1. Acesse GitHub.com ‚Üí Settings<br>
              2. Developer settings ‚Üí Personal access tokens<br>
              3. Generate new token (classic)<br>
              4. Selecione: repo, workflow, write:packages
            </p>
          </div>
        </div>
      </div>
      
      <div class="products-list">
        <h2>Produtos Cadastrados</h2>
        <div id="products-container">
          <p style="text-align: center; color: hsl(var(--muted-foreground));">
            Carregando produtos...
          </p>
        </div>
      </div>
    </div>

    <script>
      let selectedColors = new Set();
      let selectedFiles = [];
      
      // Configura√ß√£o do GitHub
      const GITHUB_CONFIG = {
        owner: 'MoveisBonafe',
        repo: 'Catalogo-Moveis-Bonafe',
        token: localStorage.getItem('github_token') || '',
        apiBase: 'https://api.github.com'
      };
      
      // Lista de produtos (dados reais do cat√°logo)
      let products = [
        {
          id: 1,
          name: "Sof√° Moderno Reclin√°vel 3 Lugares",
          category: "Sof√°s",
          description: "Sof√° premium em couro sint√©tico com sistema de reclina√ß√£o el√©trica...",
          images: ["https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=400"],
          colors: ["cinza", "preto", "bege"]
        },
        {
          id: 2,
          name: "Mesa de Jantar Extens√≠vel Carvalho",
          category: "Mesas",
          description: "Mesa elegante em madeira de carvalho maci√ßo com sistema extens√≠vel...",
          images: ["https://images.unsplash.com/photo-1449247709967-d4461a6a6103?w=400"],
          colors: ["carvalho", "mogno"]
        }
      ];
      
      // Inicializar
      document.addEventListener('DOMContentLoaded', () => {
        initializeColorSelector();
        initializeFileUpload();
        loadProducts();
        
        // Restaurar token salvo
        if (GITHUB_CONFIG.token) {
          document.getElementById('github-token').value = GITHUB_CONFIG.token;
        }
      });
      
      // Seletor de cores
      function initializeColorSelector() {
        document.querySelectorAll('.color-option').forEach(option => {
          option.addEventListener('click', () => {
            const color = option.dataset.color;
            if (selectedColors.has(color)) {
              selectedColors.delete(color);
              option.classList.remove('selected');
            } else {
              selectedColors.add(color);
              option.classList.add('selected');
            }
            document.getElementById('selected-colors').value = Array.from(selectedColors).join(',');
          });
        });
      }
      
      // Upload de arquivos
      function initializeFileUpload() {
        const fileInput = document.getElementById('product-images');
        
        fileInput.addEventListener('change', (e) => {
          selectedFiles = Array.from(e.target.files);
          displaySelectedImages();
        });
      }
      
      function displaySelectedImages() {
        const container = document.getElementById('selected-images');
        if (selectedFiles.length === 0) {
          container.innerHTML = '';
          return;
        }
        
        container.innerHTML = `
          <div style="margin-top: 12px; padding: 8px; background: hsl(var(--muted)); border-radius: 4px;">
            <p style="font-size: 14px; margin-bottom: 8px;">
              <strong>${selectedFiles.length} imagem(ns) selecionada(s):</strong>
            </p>
            ${selectedFiles.map(file => `
              <div style="font-size: 12px; color: hsl(var(--muted-foreground)); margin-bottom: 4px;">
                üìÑ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
              </div>
            `).join('')}
          </div>
        `;
      }
      
      // Upload de imagem para GitHub
      async function uploadImageToGitHub(file, filename) {
        try {
          const reader = new FileReader();
          return new Promise((resolve, reject) => {
            reader.onload = async (e) => {
              try {
                const base64Content = btoa(e.target.result);
                
                const response = await fetch(`${GITHUB_CONFIG.apiBase}/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/docs/images/produtos/${filename}`, {
                  method: 'PUT',
                  headers: {
                    'Authorization': `token ${GITHUB_CONFIG.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    message: `Upload imagem produto: ${filename}`,
                    content: base64Content
                  })
                });
                
                if (response.ok) {
                  const result = await response.json();
                  resolve(result.content.download_url);
                } else {
                  const error = await response.json();
                  reject(new Error(error.message || 'Erro no upload'));
                }
              } catch (error) {
                reject(error);
              }
            };
            reader.onerror = () => reject(new Error('Erro ao ler arquivo'));
            reader.readAsBinaryString(file);
          });
        } catch (error) {
          throw error;
        }
      }
      
      // Testar conex√£o GitHub
      async function testGitHubConnection() {
        const token = document.getElementById('github-token').value;
        if (!token) {
          showAlert('Por favor, insira o token do GitHub', 'error');
          return;
        }
        
        try {
          const response = await fetch(`${GITHUB_CONFIG.apiBase}/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`, {
            headers: {
              'Authorization': `token ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (response.ok) {
            GITHUB_CONFIG.token = token;
            localStorage.setItem('github_token', token);
            showAlert('‚úÖ Conex√£o com GitHub estabelecida com sucesso!', 'success');
          } else {
            showAlert('‚ùå Erro na conex√£o. Verifique o token e permiss√µes.', 'error');
          }
        } catch (error) {
          showAlert('‚ùå Erro de rede ao conectar com GitHub', 'error');
        }
      }
      
      // Enviar formul√°rio
      document.getElementById('product-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!GITHUB_CONFIG.token) {
          showAlert('Configure o token do GitHub primeiro', 'error');
          return;
        }
        
        const submitBtn = document.getElementById('submit-btn');
        const progressContainer = document.getElementById('upload-progress');
        const progressFill = document.getElementById('progress-fill');
        const uploadStatus = document.getElementById('upload-status');
        
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ Salvando...';
        progressContainer.classList.remove('hidden');
        
        try {
          const formData = new FormData(e.target);
          const productData = {
            id: Date.now(),
            name: formData.get('name'),
            category: formData.get('category'),
            description: formData.get('description'),
            colors: Array.from(selectedColors),
            images: []
          };
          
          // Upload das imagens
          if (selectedFiles.length > 0) {
            uploadStatus.textContent = 'Fazendo upload das imagens...';
            
            for (let i = 0; i < selectedFiles.length; i++) {
              const file = selectedFiles[i];
              const filename = `${productData.id}-${i + 1}-${file.name.replace(/[^a-zA-Z0-9.-]/g, '_')}`;
              
              uploadStatus.textContent = `Upload ${i + 1}/${selectedFiles.length}: ${file.name}`;
              progressFill.style.width = `${((i) / selectedFiles.length) * 100}%`;
              
              try {
                const imageUrl = await uploadImageToGitHub(file, filename);
                productData.images.push(imageUrl);
              } catch (error) {
                console.error('Erro no upload da imagem:', error);
                // Usar placeholder em caso de erro
                productData.images.push(`https://via.placeholder.com/400x300/f39c12/ffffff?text=${encodeURIComponent(productData.name)}`);
              }
            }
            
            progressFill.style.width = '100%';
            uploadStatus.textContent = 'Upload conclu√≠do!';
          }
          
          // Adicionar produto √† lista
          products.push(productData);
          
          showAlert('‚úÖ Produto salvo com sucesso!', 'success');
          
          // Limpar formul√°rio
          e.target.reset();
          selectedColors.clear();
          selectedFiles = [];
          document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
          document.getElementById('selected-images').innerHTML = '';
          progressContainer.classList.add('hidden');
          
          // Recarregar lista de produtos
          loadProducts();
          
        } catch (error) {
          showAlert('‚ùå Erro ao salvar produto: ' + error.message, 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'üíæ Salvar Produto';
          progressContainer.classList.add('hidden');
        }
      });
      
      // Carregar produtos
      function loadProducts() {
        const container = document.getElementById('products-container');
        
        if (products.length === 0) {
          container.innerHTML = `
            <p style="text-align: center; color: hsl(var(--muted-foreground));">
              Nenhum produto cadastrado ainda.
            </p>
          `;
          return;
        }
        
        container.innerHTML = products.map(product => `
          <div class="product-item">
            <img src="${product.images[0] || 'https://via.placeholder.com/60x60/f39c12/ffffff?text=Produto'}" 
                 alt="${product.name}"
                 onerror="this.src='https://via.placeholder.com/60x60/f39c12/ffffff?text=Produto'">
            <div class="product-info">
              <h4>${product.name}</h4>
              <p>${product.category} ‚Ä¢ ${product.colors.join(', ')}</p>
            </div>
            <div class="product-actions">
              <button class="button button-secondary" onclick="editProduct(${product.id})">
                ‚úèÔ∏è Editar
              </button>
              <button class="button" style="background: hsl(var(--destructive));" 
                      onclick="deleteProduct(${product.id})">
                üóëÔ∏è Excluir
              </button>
            </div>
          </div>
        `).join('');
      }
      
      // Fun√ß√µes de produto
      function editProduct(id) {
        showAlert('Fun√ß√£o de edi√ß√£o em desenvolvimento', 'error');
      }
      
      function deleteProduct(id) {
        if (confirm('Tem certeza que deseja excluir este produto?')) {
          products = products.filter(p => p.id !== id);
          showAlert('Produto exclu√≠do com sucesso!', 'success');
          loadProducts();
        }
      }
      
      // Mostrar alertas
      function showAlert(message, type) {
        const container = document.getElementById('alert-container');
        const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
        
        container.innerHTML = `
          <div class="alert ${alertClass}">
            ${message}
          </div>
        `;
        
        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }
      
      // Inicializar
      loadProducts();
    </script>
  </body>
</html>